---

- include_vars: "/opt/docker/etc/application.{{ PROVISION_CONTEXT }}.yml"

- name: Fact - php pool on centos
  set_fact:
     php_pool_conf: /etc/php-fpm.d/www.conf
  when: ansible_distribution == 'CentOS'

- name: Fact - php pool on ubuntu
  set_fact:
     php_pool_conf: /etc/php5/fpm/pool.d/www.conf
  when: ansible_distribution == 'Ubuntu' or ansible_distribution == 'Debian'

- name: Configure php-fpm (pool www.conf)
  lineinfile:
    dest:   "{{ php_pool_conf }}"
    regexp: '^[\s;]*{{ item.variable }}[\s]*='
    line:   '{{ item.variable }} = {{ item.value }}'
  with_items: "{{ PHP.fpm.conf }}"
  when: PHP.fpm.conf is defined and item.value != ""
